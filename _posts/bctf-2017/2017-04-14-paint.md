---
layout: post
title: Paint
category: BCTF-2017
---

# Description

BCTF was really fun this year, since I managed to solve a couple of challenges :)

I decided to do a writeup on this particular challenge as I found the
vulnerability really interesting. Since only about 10-20 teams solved it,
I think the solution to the challenge is worth sharing.

I'll also take this time to write a bit about my general methodology
behind approaching web challenges, since they can be pretty rough if you don't
know where to start!

# The Challenge

We are given a website which is basically an online painting app.

The app has the following features :
  - Draw various lines/shapes in a canvas
  - Import images from the filesystem
  - Import images from a given URL
  - Save the canvas as an image

Going through my usual methodology, I start by rapidly testing each feature
to get a better understanding of how each of them work as well as write down
any kind of vulnerability that would come to mind.

When all is done, we can reach the following conclusions :

  - Drawing lines/shapes is a 100% javascript feature. Since there's no concept of `users` (for client side attacks), we can safely assume that this feature is irrelevant here.

  - Saving the canvas sends a `POST` request with `base64` encoded data
  generated by the canvas. The data is then converted to a PNG server
  side, and sent back as a response to the user for download.
  **Vulnerabilities that come to mind : ImageTragick.**

  - Importing images from the filesystem consists of a simple `POST` request
 sending our file to the server. The webserver then saves it in an `/uploads`
 folder for use in the canvas, and responds to the user with the location +
 size of the uploaded file. Weirdly enough, the server doesn't validate whether
 the given file is a legitimate image.
 **Vulnerabilities that come to mind : Command injection in the filename,
 ImageTragick and unrestricted file upload (PHP webshells).**

 - Lastly, importing images from a URL is a `POST` request with a given URL.
 The server sends a request to the given URL, checks if the response is in fact
 an image, and responds accordingly. Just like the other import feature, the
 response will include the size of the file found in the URL, as well as the
 `/uploads` path or an error message if the URL is an invalid image.
 **Vulnerabilities that come to mind : SSRF, ImageTragick and PHP webshell uploads.**

Now that we have a better understanding of the app, check the
